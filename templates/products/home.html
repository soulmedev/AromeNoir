{% extends 'base.html' %}
{% load static %}
{% block content %}
    <section class="hero" id="home">
        <div class="hero-content">
            <div class="hero-badge">✦ Колекція 2025 ✦</div>
            <h1>AROME NOIR</h1>
            <div class="subtitle">L'essence de l'élégance</div>
            <p>Поринь у світ вишуканих ароматів від найкращих світових брендів. Ми пропонуємо оригінальні парфуми для тих, хто цінує справжню розкіш, якість та автентичність.</p>
            <button class="cta-button" onclick="scrollToProducts()">
                <span style="position: relative; z-index: 1;">Дослідити колекцію</span>
            </button>
        </div>
    </section>

    <div class="features">
        <div class="feature-card">
            <div class="feature-icon"><i class="fas fa-shipping-fast"></i></div>
            <h3>Доставка по світу</h3>
            <p>Безкоштовна експрес-доставка у будь-яку точку світу протягом 3-5 днів</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon"><i class="fas fa-certificate"></i></div>
            <h3>Сертифікат якості</h3>
            <p>Кожен флакон супроводжується сертифікатом автентичності</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon"><i class="fas fa-gem"></i></div>
            <h3>Преміум упаковка</h3>
            <p>Ексклюзивна подарункова упаковка ручної роботи</p>
        </div>
    </div>

    <section class="products" id="products">
        <h2 class="section-title">Наша порада</h2>
        <p class="section-subtitle">Шедеври парфумерного мистецтва</p>
        <div class="product-grid">
            {% for product in products %}
            <div class="product-card">
                <a href="{% url 'products:product_detail' product.slug %}" class="product-card-link"></a>
                <div class="product-image-container">
                    <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image">
                    {% if product.get_badge %}
                    <div class="product-badge">{{ product.get_badge }}</div>
                    {% endif %}
                </div>
                <div class="product-info">
                    <div class="product-category">{{ product.category }}</div>
                    <div class="product-name">{{ product.name }}</div>
                    <div class="product-description">{{ product.description }}</div>
                    <div class="product-rating" data-rating="{% if product.rating %}{{ product.rating }}{% else %}5.0{% endif %}">
                        <span class="star" data-star-num="1">
                            <i class="far fa-star star-empty"></i>
                            <span class="star-full-wrapper">
                                <i class="fas fa-star star-full"></i>
                            </span>
                        </span>
                        <span class="star" data-star-num="2">
                            <i class="far fa-star star-empty"></i>
                            <span class="star-full-wrapper">
                                <i class="fas fa-star star-full"></i>
                            </span>
                        </span>
                        <span class="star" data-star-num="3">
                            <i class="far fa-star star-empty"></i>
                            <span class="star-full-wrapper">
                                <i class="fas fa-star star-full"></i>
                            </span>
                        </span>
                        <span class="star" data-star-num="4">
                            <i class="far fa-star star-empty"></i>
                            <span class="star-full-wrapper">
                                <i class="fas fa-star star-full"></i>
                            </span>
                        </span>
                        <span class="star" data-star-num="5">
                            <i class="far fa-star star-empty"></i>
                            <span class="star-full-wrapper">
                                <i class="fas fa-star star-full"></i>
                            </span>
                        </span>
                    </div>
                    <div class="product-footer">
                        <div class="product-price">{{ product.price }} ₴</div>
                        <form action="{% url 'cart:cart_add' product.id %}" method="post" class="add-to-cart-form" onclick="event.stopPropagation()">
                            {% csrf_token %}
                            <input type="hidden" name="quantity" value="1">
                            <input type="hidden" name="override" value="False">
                            <button type="submit" class="add-to-cart">
                                <i class="fas fa-shopping-bag"></i> До кошика
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script src="{% static 'js/home.js' %}"></script>
    <script>
        function updateStarRatings() {
            const ratings = document.querySelectorAll('.product-rating[data-rating]');
            
            ratings.forEach(function(ratingEl) {
                const ratingValue = ratingEl.getAttribute('data-rating');
                if (!ratingValue) return;
                
                const normalizedValue = ratingValue.replace(',', '.');
                const rating = parseFloat(normalizedValue);
                if (isNaN(rating) || rating < 0 || rating > 5) return;
                
                const stars = ratingEl.querySelectorAll('.star');
                
                const fullStars = Math.floor(rating);
                const decimalPart = (rating % 1).toFixed(2);
                const decimalPartNum = parseFloat(decimalPart);
                const hasPartial = decimalPartNum > 0.001;
                
                stars.forEach(function(star) {
                    const starNum = parseInt(star.getAttribute('data-star-num'));
                    const starFullWrapper = star.querySelector('.star-full-wrapper');
                    
                    if (!starFullWrapper) return;
                    
                    if (starNum <= fullStars) {
                        starFullWrapper.style.width = '13px';
                    } else if (hasPartial && starNum === fullStars + 1) {
                        const width = 13 * decimalPartNum;
                        starFullWrapper.style.width = width + 'px';
                    } else {
                        starFullWrapper.style.width = '0';
                    }
                });
            });
        }
        
        function initStarRatings() {
            setTimeout(function() {
                updateStarRatings();
            }, 100);
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initStarRatings);
        } else {
            initStarRatings();
        }
    </script>
{% endblock %}